{% extends "base.html" %} {% block content %}
<div class="dashboard-grid">
  <div class="welcome-banner">
    <h1>Welcome back, {{ current_user.username }}</h1>
    <p>System operational. What shall we focus on today?</p>
  </div>

  <div class="stats-container">
    <div class="stat-card">
      <div class="ring-container">
        <svg class="progress-ring" width="80" height="80">
          <circle
            class="progress-ring__circle-bg"
            stroke="rgba(255,255,255,0.1)"
            stroke-width="6"
            fill="transparent"
            r="34"
            cx="40"
            cy="40"
          />
          <circle
            class="progress-ring__circle"
            id="cpu-ring"
            stroke="#3b82f6"
            stroke-width="6"
            fill="transparent"
            r="34"
            cx="40"
            cy="40"
          />
        </svg>
        <div class="icon-center"><i class="ph ph-cpu"></i></div>
      </div>
      <div class="stat-info">
        <h4>CPU</h4>
        <span id="cpu-text">0%</span>
      </div>
    </div>

    <div class="stat-card">
      <div class="ring-container">
        <svg class="progress-ring" width="80" height="80">
          <circle
            class="progress-ring__circle-bg"
            stroke="rgba(255,255,255,0.1)"
            stroke-width="6"
            fill="transparent"
            r="34"
            cx="40"
            cy="40"
          />
          <circle
            class="progress-ring__circle"
            id="ram-ring"
            stroke="#10b981"
            stroke-width="6"
            fill="transparent"
            r="34"
            cx="40"
            cy="40"
          />
        </svg>
        <div class="icon-center"><i class="ph ph-memory"></i></div>
      </div>
      <div class="stat-info">
        <h4>RAM</h4>
        <span id="ram-text">0%</span>
      </div>
    </div>

    <div class="stat-card">
      <div class="ring-container">
        <svg class="progress-ring" width="80" height="80">
          <circle
            class="progress-ring__circle-bg"
            stroke="rgba(255,255,255,0.1)"
            stroke-width="6"
            fill="transparent"
            r="34"
            cx="40"
            cy="40"
          />
          <circle
            class="progress-ring__circle"
            id="disk-ring"
            stroke="#f59e0b"
            stroke-width="6"
            fill="transparent"
            r="34"
            cx="40"
            cy="40"
          />
        </svg>
        <div class="icon-center"><i class="ph ph-hard-drive"></i></div>
      </div>
      <div class="stat-info">
        <h4>DISK</h4>
        <span id="disk-text">0%</span>
      </div>
    </div>
  </div>

  <script>
    function setProgress(id, percent) {
      const circle = document.getElementById(id);
      const radius = circle.r.baseVal.value;
      const circumference = radius * 2 * Math.PI;

      circle.style.strokeDasharray = `${circumference} ${circumference}`;

      // Calculate offset (how much is hidden)
      const offset = circumference - (percent / 100) * circumference;
      circle.style.strokeDashoffset = offset;
    }

    async function fetchStats() {
      try {
        const response = await fetch("/api/stats");
        const data = await response.json();

        // Update Text
        document.getElementById("cpu-text").innerText = data.cpu + "%";
        document.getElementById("ram-text").innerText = data.ram + "%";
        document.getElementById("disk-text").innerText = data.disk + "%";

        // Update Rings
        setProgress("cpu-ring", data.cpu);
        setProgress("ram-ring", data.ram);
        setProgress("disk-ring", data.disk);
      } catch (error) {
        console.error("Error fetching stats:", error);
      }
    }

    // Run once immediately, then every 2 seconds
    fetchStats();
    setInterval(fetchStats, 2000);
  </script>

  <div class="section-container apps-section">
    <h3><i class="ph ph-grid-nine"></i> Applications</h3>
    <div class="app-grid">
      <div class="app-card">
        <div class="app-icon" style="background: #eab308">
          <i class="ph ph-folder"></i>
        </div>
        <h4>Files</h4>
        <span>Coming Soon</span>
      </div>
      <div class="app-card">
        <div class="app-icon" style="background: #3b82f6">
          <i class="ph ph-terminal-window"></i>
        </div>
        <h4>Terminal</h4>
        <span>Coming Soon</span>
      </div>
      <div class="app-card">
        <div class="app-icon" style="background: #10b981">
          <i class="ph ph-chart-line-up"></i>
        </div>
        <h4>Analytics</h4>
        <span>Coming Soon</span>
      </div>
      <div class="app-card add-new">
        <i class="ph ph-plus"></i>
        <h4>Add App</h4>
      </div>
    </div>
  </div>

  <div class="section-container todo-section">
    <div class="section-header">
      <h3><i class="ph ph-check-circle"></i> Priority Tasks</h3>
      <button class="icon-btn"><i class="ph ph-plus"></i></button>
    </div>

    <div class="todo-list">
      <div class="todo-item">
        <input type="checkbox" id="t1" />
        <label for="t1">Connect Google Tasks API</label>
      </div>
      <div class="todo-item">
        <input type="checkbox" id="t2" />
        <label for="t2">Design Server Stats Widget</label>
      </div>
      <div class="todo-item">
        <input type="checkbox" id="t3" checked />
        <label for="t3">Finish Login Screen UI</label>
      </div>
      <div class="todo-item">
        <input type="checkbox" id="t4" />
        <label for="t4">Buy more coffee â˜•</label>
      </div>
    </div>
  </div>
</div>
{% endblock %}
