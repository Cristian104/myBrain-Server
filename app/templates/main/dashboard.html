{% extends "base.html" %} {% block content %}
<div class="dashboard-content">
  <div class="welcome-banner">
    <h1>Welcome back, {{ current_user.username|title }}</h1>
    <p>System operational. Ready for command.</p>
  </div>

  <div class="stats-row">
    <div class="stat-card">
      <div class="stat-icon cpu-color"><i class="fas fa-microchip"></i></div>
      <div class="stat-details">
        <h3>CPU</h3>
        <h2 id="cpu-text">0%</h2>
        <div class="progress-track">
          <div
            class="progress-fill cpu-fill"
            id="cpu-bar"
            style="width: 0%"
          ></div>
        </div>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon ram-color"><i class="fas fa-memory"></i></div>
      <div class="stat-details">
        <h3>RAM</h3>
        <h2 id="ram-text">0%</h2>
        <div class="progress-track">
          <div
            class="progress-fill ram-fill"
            id="ram-bar"
            style="width: 0%"
          ></div>
        </div>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon disk-color"><i class="fas fa-hdd"></i></div>
      <div class="stat-details">
        <h3>DISK</h3>
        <h2 id="disk-text">0%</h2>
        <div class="progress-track">
          <div
            class="progress-fill disk-fill"
            id="disk-bar"
            style="width: 0%"
          ></div>
        </div>
      </div>
    </div>
  </div>

  <div class="dashboard-split">
    <div class="panel-left">
      <div class="section-header">
        <h2><i class="fas fa-rocket"></i> Applications</h2>
      </div>
      <div class="apps-grid">
        <a href="https://google.com" target="_blank" class="app-card">
          <div class="app-icon"><i class="fab fa-google"></i></div>
          <span>Search</span>
        </a>
        <a href="#" class="app-card">
          <div class="app-icon"><i class="fas fa-server"></i></div>
          <span>Portainer</span>
        </a>
        <a href="#" class="app-card">
          <div class="app-icon"><i class="fas fa-shield-alt"></i></div>
          <span>Pi-hole</span>
        </a>
        <a href="#" class="app-card">
          <div class="app-icon"><i class="fas fa-play"></i></div>
          <span>Plex</span>
        </a>
      </div>
    </div>

    <div class="panel-right">
      <div class="section-header">
        <h2><i class="fas fa-tasks"></i> Tasks</h2>
        <div class="header-actions" style="display: flex; gap: 10px">
          <button class="btn-sm" onclick="toggleQuickAdd()">New</button>
          <button
            class="btn-sm"
            style="background: #2ecc71"
            onclick="openModal()"
          >
            New+
          </button>
        </div>
      </div>

      <div
        class="category-menu"
        style="margin-bottom: 20px; justify-content: flex-start"
      >
        <button class="cat-pill active" onclick="filterTasks('all', this)">
          <span>All</span>
        </button>
        <button class="cat-pill" onclick="filterTasks('work', this)">
          üíº <span>Work</span>
        </button>
        <button class="cat-pill" onclick="filterTasks('personal', this)">
          üè† <span>Personal</span>
        </button>
        <button class="cat-pill" onclick="filterTasks('dev', this)">
          üíª <span>Dev</span>
        </button>
        <button class="cat-pill" onclick="filterTasks('health', this)">
          ‚ù§Ô∏è <span>Health</span>
        </button>
      </div>

      <div class="tasks-card">
        <div class="quick-add-row" id="quick-add-row">
          <select id="quick-category" class="quick-select">
            <option value="general">General</option>
            <option value="work">Work</option>
            <option value="personal">Personal</option>
            <option value="dev">Dev</option>
            <option value="health">Health</option>
          </select>
          <input
            type="text"
            id="quick-task-input"
            class="quick-add-input"
            placeholder="Type and hit Enter..."
            onkeypress="handleQuickEnter(event)"
          />
        </div>

        <div id="task-list">
          {% for task in tasks %}
          <div
            class="task-row {% if task.complete %}completed{% endif %}"
            id="task-{{ task.id }}"
            data-category="{{ task.category or 'general' }}"
            style="{% if task.complete and task.category and task.category != 'general' %}display: none;{% endif %}"
          >
            <div
              class="priority-dot"
              style="background-color: {{ task.color or '#3b5bdb' }}; box-shadow: 0 0 8px {{ task.color or '#3b5bdb' }};"
            ></div>

            <div
              class="task-info"
              onclick="editTask(this)"
              data-id="{{ task.id }}"
              data-content="{{ task.content }}"
              data-priority="{{ task.priority }}"
              data-date="{{ task.due_date }}"
              data-color="{{ task.color }}"
              data-recurrence="{{ task.recurrence }}"
              data-category="{{ task.category or 'general' }}"
              data-ishabit="{{ 'true' if task.is_habit else 'false' }}"
            >
              <span class="task-title">
                {{ task.content }} {% if task.category and task.category !=
                'general' %}
                <span class="badge-mini badge-{{ task.category }}"
                  >{{ task.category }}</span
                >
                {% endif %}
              </span>

              <span class="task-meta">
                {{ task.priority|capitalize }} {% if task.due_date %} ‚Ä¢ {% set
                days_left = (task.due_date.date() - now.date()).days %} {% if
                days_left < 0 %}
                <span style="color: var(--danger-red); font-weight: bold"
                  >{{ days_left|abs }}d overdue</span
                >
                {% elif days_left == 0 %}
                <span style="color: var(--accent-blue); font-weight: bold"
                  >Today</span
                >
                {% elif days_left == 1 %} Tomorrow {% else %} {{ days_left }}d
                left {% endif %} {% endif %} {% if task.recurrence != 'none' %}
                ‚Ä¢ <i class="fas fa-sync-alt" title="Repeats"></i>
                {% endif %}
              </span>
            </div>

            <div class="task-actions">
              <button
                class="btn-check-circle"
                id="btn-check-{{ task.id }}"
                onclick="toggleTask({{ task.id }})"
              >
                {% if task.complete %}<i class="fas fa-check"></i>{% endif %}
              </button>
              <button
                class="btn-delete"
                id="btn-del-{{ task.id }}"
                onclick="handleDeleteClick(event, {{ task.id }})"
              >
                <i class="fas fa-trash"></i>
              </button>
            </div>
          </div>
          {% else %}
          <p class="no-tasks">No active tasks.</p>
          {% endfor %}
        </div>
      </div>
    </div>
  </div>

  <div class="stats-layout-wrapper">
    <div class="stats-col-left card-glass">
      <h4
        class="desktop-only"
        style="margin-bottom: 15px; color: var(--text-gray); width: 100%"
      >
        Weekly Focus
      </h4>
      <h3 class="mobile-header">Focus</h3>
      <div id="radial-chart" style="width: 100%"></div>
    </div>

    <div class="stats-col-right card-glass">
      <div
        class="desktop-only"
        style="
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: 15px;
        "
      >
        <h4 style="color: var(--text-gray); margin: 0">
          Habit Consistency (30 Days)
        </h4>
        <span class="badge-mini badge-health">Health & Meds</span>
      </div>
      <h3 class="mobile-header">Habits</h3>
      <div
        id="habit-heatmap"
        class="life-stats-container"
        style="width: 100%"
      ></div>
    </div>
  </div>

  <div id="task-modal" class="modal-overlay">
    <div class="modal-box">
      <h3>Create New Task</h3>

      <label>Description</label>
      <input type="text" id="m-content" placeholder="What needs doing?" />

      <label>Priority</label>
      <select id="m-priority">
        <option value="normal">Normal</option>
        <option value="high">High</option>
        <option value="urgent">Urgent</option>
      </select>

      <label>Due Date</label>
      <input type="date" id="m-date" />

      <label>Recurrence</label>
      <select id="m-recurrence">
        <option value="none">One-time</option>
        <option value="daily">Daily</option>
        <option value="weekly">Weekly</option>
      </select>

      <label>Context</label>
      <select id="m-category">
        <option value="general">General</option>
        <option value="work">üíº Work</option>
        <option value="personal">üè† Personal</option>
        <option value="dev">üíª Dev</option>
        <option value="health">‚ù§Ô∏è Health</option>
      </select>

      <div
        class="form-group"
        style="margin: 15px 0; display: flex; align-items: center; gap: 10px"
      >
        <input
          type="checkbox"
          id="m-is-habit"
          style="width: auto; margin: 0; cursor: pointer"
        />
        <label
          for="m-is-habit"
          style="
            margin: 0;
            cursor: pointer;
            user-select: none;
            color: var(--text-gray);
          "
        >
          üìà Track as Daily Habit (Show in Charts)
        </label>
      </div>

      <label>Color Tag</label>
      <div class="color-picker-row">
        <div
          class="color-dot"
          style="background: #3b5bdb"
          onclick="selectColor('#3b5bdb')"
        ></div>
        <div
          class="color-dot"
          style="background: #e74c3c"
          onclick="selectColor('#e74c3c')"
        ></div>
        <div
          class="color-dot"
          style="background: #2ecc71"
          onclick="selectColor('#2ecc71')"
        ></div>
        <div
          class="color-dot"
          style="background: #f1c40f"
          onclick="selectColor('#f1c40f')"
        ></div>
        <div
          class="color-dot"
          style="background: #9b59b6"
          onclick="selectColor('#9b59b6')"
        ></div>
      </div>
      <input type="hidden" id="m-color" value="#3b5bdb" />

      <div class="modal-actions">
        <button class="btn-cancel" onclick="closeModal()">Cancel</button>
        <button class="btn-save" onclick="submitTaskForm()">Save Task</button>
      </div>
    </div>
  </div>

  <div id="delete-modal" class="modal-overlay">
    <div class="modal-card delete-mode">
      <div class="modal-header">
        <h3><i class="fas fa-exclamation-triangle"></i> Delete Habit?</h3>
        <button class="btn-close" onclick="closeDeleteModal()">&times;</button>
      </div>
      <div class="modal-body">
        <p>
          You are about to delete
          <strong><span id="del-task-name">this task</span></strong
          >.
        </p>
        <p class="warning-text">
          This is a tracked habit. Deleting it will
          <strong>permanently erase all history</strong> and streaks associated
          with it from the heatmap.
        </p>
        <p>This action cannot be undone.</p>
      </div>
      <div class="modal-footer">
        <button class="btn-cancel" onclick="closeDeleteModal()">Cancel</button>
        <button class="btn-danger-confirm" id="btn-confirm-delete">
          Yes, Delete Everything
        </button>
      </div>
    </div>
  </div>

  {% endblock %}
</div>
